const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/opencv-Cg6dp1wg.js","assets/index-rQLcFmgX.js","assets/ort.bundle.min-D7xVg6BR.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const yt="modulepreload",bt=function(e){return"/"+e},lt={},ht=function(t,r,s){let o=Promise.resolve();if(r&&r.length>0){let c=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};var l=c;document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),i=n?.nonce||n?.getAttribute("nonce");o=c(r.map(d=>{if(d=bt(d),d in lt)return;lt[d]=!0;const u=d.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":yt,u||(h.as="script"),h.crossOrigin="",h.href=d,i&&h.setAttribute("nonce",i),document.head.appendChild(h),u)return new Promise((p,y)=>{h.addEventListener("load",p),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return o.then(n=>{for(const i of n||[])i.status==="rejected"&&a(i.reason);return t().catch(a)})};function Tt(e,t){if(!Number.isInteger(t)||t<=0)throw new Error("Size must be an integer greater than zero.");const r=Math.ceil(e.length/t),s=Array(r);for(let o=0;o<r;o++){const a=o*t,l=a+t;s[o]=e.slice(a,l)}return s}const gt="/assets/object-detect-DKSFrVWF.onnx",xt="/assets/text-detect-Cl_XIpL2.onnx",Et="/assets/text-recognition-BGsAHInl.onnx",Mt=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];const s=r.getContext("2d");if(s!=null){let o,a;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[3]):(o=e.dims[3],a=e.dims[2]);const l=t?.format!==void 0?t.format:"RGB",n=t?.norm;let i,c;n===void 0||n.mean===void 0?i=[255,255,255,255]:typeof n.mean=="number"?i=[n.mean,n.mean,n.mean,n.mean]:(i=[n.mean[0],n.mean[1],n.mean[2],0],n.mean[3]!==void 0&&(i[3]=n.mean[3])),n===void 0||n.bias===void 0?c=[0,0,0,0]:typeof n.bias=="number"?c=[n.bias,n.bias,n.bias,n.bias]:(c=[n.bias[0],n.bias[1],n.bias[2],0],n.bias[3]!==void 0&&(c[3]=n.bias[3]));const d=a*o;let u=0,f=d,h=d*2,p=-1;l==="RGBA"?(u=0,f=d,h=d*2,p=d*3):l==="RGB"?(u=0,f=d,h=d*2):l==="RBG"&&(u=0,h=d,f=d*2);for(let y=0;y<a;y++)for(let w=0;w<o;w++){const m=(e.data[u++]-c[0])*i[0],T=(e.data[f++]-c[1])*i[1],x=(e.data[h++]-c[2])*i[2],b=p===-1?255:(e.data[p++]-c[3])*i[3];s.fillStyle="rgba("+m+","+T+","+x+","+b+")",s.fillRect(w,y,1,1)}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},At=(e,t)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let s;if(r!=null){let o,a,l;t?.tensorLayout!==void 0&&t.tensorLayout==="NHWC"?(o=e.dims[2],a=e.dims[1],l=e.dims[3]):(o=e.dims[3],a=e.dims[2],l=e.dims[1]);const n=t!==void 0&&t.format!==void 0?t.format:"RGB",i=t?.norm;let c,d;i===void 0||i.mean===void 0?c=[255,255,255,255]:typeof i.mean=="number"?c=[i.mean,i.mean,i.mean,i.mean]:(c=[i.mean[0],i.mean[1],i.mean[2],255],i.mean[3]!==void 0&&(c[3]=i.mean[3])),i===void 0||i.bias===void 0?d=[0,0,0,0]:typeof i.bias=="number"?d=[i.bias,i.bias,i.bias,i.bias]:(d=[i.bias[0],i.bias[1],i.bias[2],0],i.bias[3]!==void 0&&(d[3]=i.bias[3]));const u=a*o;if(t!==void 0&&(t.format!==void 0&&l===4&&t.format!=="RGBA"||l===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const f=4;let h=0,p=1,y=2,w=3,m=0,T=u,x=u*2,b=-1;n==="RGBA"?(m=0,T=u,x=u*2,b=u*3):n==="RGB"?(m=0,T=u,x=u*2):n==="RBG"&&(m=0,x=u,T=u*2),s=r.createImageData(o,a);for(let C=0;C<a*o;h+=f,p+=f,y+=f,w+=f,C++)s.data[h]=(e.data[m++]-d[0])*c[0],s.data[p]=(e.data[T++]-d[1])*c[1],s.data[y]=(e.data[x++]-d[2])*c[2],s.data[w]=b===-1?255:(e.data[b++]-d[3])*c[3]}else throw new Error("Can not access image data");return s},rt=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:s}=t,o=t.norm??{mean:255,bias:0};let a,l;typeof o.mean=="number"?a=[o.mean,o.mean,o.mean,o.mean]:a=[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],typeof o.bias=="number"?l=[o.bias,o.bias,o.bias,o.bias]:l=[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];const n=t.format!==void 0?t.format:"RGBA",i=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",c=r*s,d=i==="RGBA"?new Float32Array(c*4):new Float32Array(c*3);let u=4,f=0,h=1,p=2,y=3,w=0,m=c,T=c*2,x=-1;n==="RGB"&&(u=3,f=0,h=1,p=2,y=-1),i==="RGBA"?x=c*3:i==="RBG"?(w=0,T=c,m=c*2):i==="BGR"&&(T=0,m=c,w=c*2);for(let C=0;C<c;C++,f+=u,p+=u,h+=u,y+=u)d[w++]=(e[f]+l[0])/a[0],d[m++]=(e[h]+l[1])/a[1],d[T++]=(e[p]+l[2])/a[2],x!==-1&&y!==-1&&(d[x++]=(e[y]+l[3])/a[3]);return i==="RGBA"?new S("float32",d,[1,4,r,s]):new S("float32",d,[1,3,r,s])},Ct=async(e,t)=>{const r=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,o=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,a=typeof e=="string";let l,n=t??{};const i=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=d=>typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||d instanceof OffscreenCanvas?d.getContext("2d"):null;if(r){const d=i();d.width=e.width,d.height=e.height;const u=c(d);if(u!=null){let f=e.height,h=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(f=t.resizedHeight,h=t.resizedWidth),t!==void 0){if(n=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");n.tensorFormat="RGBA",n.height=f,n.width=h}else n.tensorFormat="RGBA",n.height=f,n.width=h;u.drawImage(e,0,0),l=u.getImageData(0,0,h,f).data}else throw new Error("Can not access image data")}else if(s){let d,u;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(d=t.resizedHeight,u=t.resizedWidth):(d=e.height,u=e.width),t!==void 0&&(n=t),n.format="RGBA",n.height=d,n.width=u,t!==void 0){const f=i();f.width=u,f.height=d;const h=c(f);if(h!=null)h.putImageData(e,0,0),l=h.getImageData(0,0,u,d).data;else throw new Error("Can not access image data")}else l=e.data}else if(o){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");const d=i();d.width=e.width,d.height=e.height;const u=c(d);if(u!=null){const f=e.height,h=e.width;return u.drawImage(e,0,0,h,f),l=u.getImageData(0,0,h,f).data,n.height=f,n.width=h,rt(l,n)}else throw new Error("Can not access image data")}else{if(a)return new Promise((d,u)=>{const f=i(),h=c(f);if(!e||!h)return u();const p=new Image;p.crossOrigin="Anonymous",p.src=e,p.onload=()=>{f.width=p.width,f.height=p.height,h.drawImage(p,0,0,f.width,f.height);const y=h.getImageData(0,0,f.width,f.height);n.height=f.height,n.width=f.width,d(rt(y.data,n))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(l!==void 0)return rt(l,n);throw new Error("Input data provided is not supported - aborted tensor creation")},Rt=(e,t)=>{const{width:r,height:s,download:o,dispose:a}=t,l=[1,s,r,4];return new S({location:"texture",type:"float32",texture:e,dims:l,download:o,dispose:a})},It=(e,t)=>{const{dataType:r,dims:s,download:o,dispose:a}=t;return new S({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:s,download:o,dispose:a})},Pt=(e,t)=>{const{dataType:r,dims:s,download:o,dispose:a}=t;return new S({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:s,download:o,dispose:a})},_t=(e,t,r)=>new S({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]}),z=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),tt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let ut=!1;const Ot=()=>{if(!ut){ut=!0;const e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,r=globalThis.Float16Array,s=typeof r<"u"&&r.from;e&&(z.set("int64",BigInt64Array),tt.set(BigInt64Array,"int64")),t&&(z.set("uint64",BigUint64Array),tt.set(BigUint64Array,"uint64")),s?(z.set("float16",r),tt.set(r,"float16")):z.set("float16",Uint16Array)}},Bt=e=>{let t=1;for(let r=0;r<e.length;r++){const s=e[r];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${r}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${s}`);t*=s}return t},Dt=(e,t)=>{switch(e.location){case"cpu":return new S(e.type,e.data,t);case"cpu-pinned":return new S({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new S({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new S({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new S({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}};let S=class{constructor(t,r,s){Ot();let o,a;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,o=t.type,a=t.dims,t.location){case"cpu-pinned":{const n=z.get(o);if(!n)throw new TypeError(`unsupported type "${o}" to create tensor from pinned buffer`);if(!(t.data instanceof n))throw new TypeError(`buffer should be of type ${n.name}`);this.cpuData=t.data;break}case"texture":{if(o!=="float32")throw new TypeError(`unsupported type "${o}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint64"&&o!=="int8"&&o!=="uint8"&&o!=="bool"&&o!=="uint4"&&o!=="int4")throw new TypeError(`unsupported type "${o}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let n,i;if(typeof t=="string")if(o=t,i=s,t==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");n=r}else{const c=z.get(t);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(r)){if(t==="float16"&&c===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${c.name} as data.`);t==="uint64"||t==="int64"?n=c.from(r,BigInt):n=c.from(r)}else if(r instanceof c)n=r;else if(r instanceof Uint8ClampedArray)if(t==="uint8")n=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&r instanceof Uint16Array&&c!==Uint16Array)n=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${o} tensor's data must be type of ${c}`)}else if(i=r,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const c=typeof t[0];if(c==="string")o="string",n=t;else if(c==="boolean")o="bool",n=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else if(t instanceof Uint8ClampedArray)o="uint8",n=Uint8Array.from(t);else{const c=tt.get(t.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);o=c,n=t}if(i===void 0)i=[n.length];else if(!Array.isArray(i))throw new TypeError("A tensor's dims must be a number array");a=i,this.cpuData=n,this.dataLocation="cpu"}const l=Bt(a);if(this.cpuData&&l!==this.cpuData.length&&!((o==="uint4"||o==="int4")&&Math.ceil(l/2)===this.cpuData.length))throw new Error(`Tensor's size(${l}) does not match data length(${this.cpuData.length}).`);this.type=o,this.dims=a,this.size=l}static async fromImage(t,r){return Ct(t,r)}static fromTexture(t,r){return Rt(t,r)}static fromGpuBuffer(t,r){return It(t,r)}static fromMLTensor(t,r){return Pt(t,r)}static fromPinnedBuffer(t,r,s){return _t(t,r,s)}toDataURL(t){return Mt(this,t)}toImageData(t){return At(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,t&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Dt(this,t)}};const ct=S;function wt(e){return 1/(1+Math.exp(-e))}function Lt(e,t){return Math.hypot(e.x-t.x,e.y-t.y)}function X(e,t){const r=t.y-e.y,s=t.x-e.x;return(360-Math.atan2(r,s)*180/Math.PI)%360}function v(e,t,r){return Math.min(Math.max(e,t),r)}function vt(e){return e.indexOf(Math.max(...e))}function St(e){const t=Math.max(...e),r=e.map(o=>Math.exp(o-t)),s=r.reduce((o,a)=>o+a,0);return r.map(o=>o/s)}function at(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function it(e,t,r=".",s){if(!at(t))return it(e,{},r,s);const o=Object.assign({},t);for(const a in e){if(a==="__proto__"||a==="constructor")continue;const l=e[a];l!=null&&(s&&s(o,a,l,r)||(Array.isArray(l)&&Array.isArray(o[a])?o[a]=[...l,...o[a]]:at(l)&&at(o[a])?o[a]=it(l,o[a],(r?`${r}.`:"")+a.toString(),s):o[a]=l))}return o}function Nt(e){return(...t)=>t.reduce((r,s)=>it(r,s,"",e),{})}const mt=Nt();let st;async function B(){if(!st){const{default:e}=await ht(async()=>{const{default:t}=await import("./opencv-Cg6dp1wg.js").then(r=>r.o);return{default:t}},__vite__mapDeps([0,1]));st=e instanceof Promise?await e:e}return st}async function et(e){const t=await B();if(e instanceof t.Mat)return e.clone();const r=new Image;return r.src=e instanceof Blob?URL.createObjectURL(e):e,await r.decode(),e instanceof Blob&&URL.revokeObjectURL(r.src),t.imread(r)}async function Ut(e,t,r=10){const s=await B(),o=new s.Mat,a=new s.MatVector;s.cvtColor(e,o,s.COLOR_RGBA2GRAY),a.push_back(o);const l=256,n=[0,256],i=new s.Mat,c=new s.Mat;s.calcHist(a,[0],c,i,[l],n);const d=[i.data32F[0]];for(let m=1;m<l;m++)d[m]=d[m-1]+i.data32F[m];const u=d[l-1],f=r*u/100/2;let h=0;for(;d[h]<f;)h++;let p=l-1;for(;d[p]>=u-f;)p--;const y=255/(p-h),w=-h*y;e.convertTo(t,-1,y,w),a.delete(),o.delete(),i.delete(),c.delete()}function Gt(e,t,r,s=.5){for(let o=0;o<e.rows;o++)for(let a=0;a<e.cols;a++){const l=t.ucharPtr(o,a)[0],n=s*l/255,i=1-n,c=e.ucharPtr(o,a);for(let d=0;d<e.channels();d++)c[d]=c[d]*i+r[d]*n}}var pt=(e=>(e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_CENTER=1]="TOP_CENTER",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MID_LEFT=4]="MID_LEFT",e[e.MID_CENTER=5]="MID_CENTER",e[e.MID_RIGHT=6]="MID_RIGHT",e[e.BOTTOM_LEFT=8]="BOTTOM_LEFT",e[e.BOTTOM_CENTER=9]="BOTTOM_CENTER",e[e.BOTTOM_RIGHT=10]="BOTTOM_RIGHT",e))(pt||{});function dt(e,t,r=5){const s=Math.min(t.width/e.width,t.height/e.height),o=Math.floor(e.width*s),a=Math.floor(e.height*s),l=t.width-o,n=t.height-a;let i=0,c=0;r&1?i=Math.floor(l/2):r&2&&(i=l),r&4?c=Math.floor(n/2):r&8&&(c=n);async function d(w,m,T,x){const b=await B();b.resize(w,m,new b.Size(o,a),0,0,x??b.INTER_CUBIC),b.copyMakeBorder(m,m,c,n-c,i,l-i,b.BORDER_CONSTANT,T??new b.Scalar(0,0,0,255))}async function u(w){const m=await B(),T=await f(new m.Point(w.x,w.y)),x=await f(new m.Point(w.x+w.width,w.y+w.height),!0);return new m.Rect(v(T.x,0,o),v(T.y,0,a),v(x.x-T.x,0,o),v(x.y-T.y,0,a))}async function f(w,m=!1){const T=await B(),x=m?Math.ceil(w.x*s):Math.floor(w.x*s),b=m?Math.ceil(w.y*s):Math.floor(w.y*s);return new T.Point(v(x,0,o),v(b,0,a))}async function h(w,m,T){const x=await B(),b=new x.Rect(i,c,o,a),C=w.roi(b);x.resize(C,m,e,0,0,T??x.INTER_CUBIC),C.delete()}async function p(w){const m=await B(),T=await y(new m.Point(w.x,w.y)),x=await y(new m.Point(w.x+w.width,w.y+w.height),!0);return new m.Rect(T.x,T.y,x.x-T.x,x.y-T.y)}async function y(w,m=!1){const T=await B(),x=m?Math.ceil((w.x-i)/s):Math.floor((w.x-i)/s),b=m?Math.ceil((w.y-c)/s):Math.floor((w.y-c)/s);return new T.Point(v(x,0,e.width),v(b,0,e.height))}return{scaleMat:d,scaleRect:u,scalePoint:f,revertMat:h,revertRect:p,revertPoint:y}}function Ft({model:e,labels:t}){const r=e.inputMetadata[0],s=e.outputMetadata[0],o=e.outputMetadata[1];async function a(l,n){const i=mt(n,{confidence:.8}),c=await B(),d=await et(l),u=d.size(),f=new c.Size(r.shape[3],r.shape[2]),h=dt(u,f),p=new c.Mat,y=new c.Mat;await h.scaleMat(d,p),c.cvtColor(p,y,c.COLOR_RGBA2BGR);const w=c.blobFromImage(y,1/255,y.size(),new c.Scalar(0,0,0),!0,!1),m=new ct("float32",w.data32F,r.shape),T=await e.run({[r.name]:m}),x=T[s.name],b=T[o.name],C=s.shape[1],P=s.shape[2],R=x.data,I=b.data,A=o.shape[1],E=new c.Size(o.shape[3],o.shape[2]),O=E.width*E.height,_=[];for(let M=0;M<C;M++){const g=M*P,k=R[g+4],D=R[g+5];if(k<i.confidence||D<0||D>=t.length)continue;const W=v(Math.floor(R[g]),0,f.width),$=v(Math.floor(R[g+1]),0,f.height),nt=v(Math.ceil(R[g+2]),0,f.width),q=v(Math.ceil(R[g+3]),0,f.height),K=R.slice(g+6,g+6+A),ot=Float32Array.from({length:O},(H,V)=>{let j=0;for(let Y=0;Y<A;Y++)j+=K[Y]*I[Y*O+V];return wt(j)}),N=new c.Rect(W,$,nt-W,q-$),L=c.matFromArray(E.height,E.width,c.CV_8UC1,Uint8ClampedArray.from(ot,H=>H*255));c.resize(L,L,f,0,0,c.INTER_CUBIC),await h.revertMat(L,L);const U=await h.revertRect(N),F=L.roi(U);_.push({classId:D,label:t[D],confidence:k,bbox:[U.x,U.y,U.x+U.width,U.y+U.height],mask:Uint8ClampedArray.from({length:F.rows*F.cols},(H,V)=>{const j=Math.floor(V/F.cols),Y=V%F.cols;return F.ucharPtr(j,Y)[0]})}),L.delete(),F.delete()}return m.dispose(),x.dispose(),b.dispose(),d.delete(),p.delete(),y.delete(),w.delete(),_}return{predict:a}}function Z(e,t){const[r,s,o,a]=e,[l,n,i,c]=t,d=a-s,u=r-o,f=d*r+u*s,h=c-n,p=l-i,y=h*l+p*n,w=d*p-h*u;if(w===0)return;const m=(p*f-u*y)/w,T=(d*y-h*f)/w;return[m,T]}function J(e,t,r=!1){const s=e.length;if(!(s<2))if(r){let o=0,a=0,l=0,n=0;for(const{x:p,y}of e)o+=p,a+=y,l+=p*y,n+=y*y;const i=(s*l-a*o)/(s*n-a*a+1e-6),c=(o-i*a)/s,d=0,u=i*0+c,f=t.height,h=i*t.height+c;return[u,d,h,f]}else{let o=0,a=0,l=0,n=0;for(const{x:p,y}of e)o+=p,a+=y,l+=p*y,n+=p*p;const i=(s*l-o*a)/(s*n-o*o+1e-6),c=(a-i*o)/s,d=0,u=i*0+c,f=t.width,h=i*t.width+c;return[d,u,f,h]}}async function Ht(e){const t=await B(),r=t.minAreaRect(e),s=r.center;let o=new t.Point(0,0),a=0,l=new t.Point(0,0),n=0,i=new t.Point(0,0),c=0,d=new t.Point(0,0),u=0;for(let _=0;_<e.data32S.length;_+=2){const M=new t.Point(e.data32S[_],e.data32S[_+1]),g=Lt(M,s);M.x<s.x&&M.y<s.y?g>a&&(o=M,a=g):M.x>s.x&&M.y<s.y?g>n&&(l=M,n=g):M.x<s.x&&M.y>s.y?g>c&&(i=M,c=g):M.x>s.x&&M.y>s.y&&g>u&&(d=M,u=g)}const f=X(s,l),h=X(s,o),p=X(s,i),y=X(s,d),w=[o,l],m=[i,d],T=[o,i],x=[l,d];for(let _=0;_<e.data32S.length;_+=2){const M=new t.Point(e.data32S[_],e.data32S[_+1]),g=X(s,M);g>f&&g<h?w.push(M):g>h&&g<p?T.push(M):g>p&&g<y?m.push(M):(g>y||g<f)&&x.push(M)}const b=J(w,r.size),C=J(m,r.size),P=J(T,r.size,!0),R=J(x,r.size,!0);if(!b||!C||!P||!R)return[o,l,i,d];const I=Z(b,P),A=Z(b,R),E=Z(C,R),O=Z(C,P);return!I||!A||!E||!O?[o,l,i,d]:[new t.Point(I[0],I[1]),new t.Point(A[0],A[1]),new t.Point(O[0],O[1]),new t.Point(E[0],E[1])]}async function ft(e){let t=-1,r=Number.NEGATIVE_INFINITY;const s=await B();for(let o=0;o<e.size();o++){const a=e.get(o),l=s.contourArea(a);l>r&&(r=l,t=o),a.delete()}return t}async function kt(e,t){const r=await B(),s=new r.Mat,o=new r.Mat;r.bitwise_and(e,t,s),r.bitwise_or(e,t,o);const a=r.countNonZero(s),l=r.countNonZero(o),n=l>0?a/l:0;return s.delete(),o.delete(),n}async function $t(e,t,r,s,o){const a=await B(),l=new a.MatVector,n=new a.Mat,i=e.roi(r);a.cvtColor(i,i,a.COLOR_RGBA2GRAY);for(let d=0;d<i.rows;d++)for(let u=0;u<i.cols;u++)i.ucharPtr(d,u)[0]=Math.floor(i.ucharPtr(d,u)[0]*(s.ucharPtr(d,u)[0]/255));a.threshold(i,i,128,255,a.THRESH_BINARY+a.THRESH_OTSU),a.findContours(i,l,n,a.RETR_EXTERNAL,a.CHAIN_APPROX_SIMPLE);let c=await ft(l);if(c>-1){const d=l.get(c),u=new a.Mat;a.convexHull(d,u,!0,!0),l.set(c,u),d.delete();const f=a.Mat.zeros(s.rows,s.cols,a.CV_8UC1);if(a.drawContours(f,l,c,new a.Scalar(255),a.FILLED),await kt(f,s)<.9&&(a.findContours(s,l,n,a.RETR_EXTERNAL,a.CHAIN_APPROX_SIMPLE),c=await ft(l),c>-1)){const C=l.get(c);a.convexHull(C,u,!0,!0),l.set(c,u),C.delete()}f.delete();const p=await Ht(u),y=r.height>r.width,w=y?o.height:o.width,m=y?o.width:o.height,T=a.matFromArray(4,1,a.CV_32FC2,p.flatMap(({x:C,y:P})=>[r.x+C,r.y+P])),x=a.matFromArray(4,1,a.CV_32FC2,[0,0,w,0,0,m,w,m]),b=a.getPerspectiveTransform(T,x);a.warpPerspective(e,t,b,new a.Size(w,m),a.INTER_CUBIC,a.BORDER_CONSTANT,new a.Scalar),y&&a.rotate(t,t,a.ROTATE_90_COUNTERCLOCKWISE),T.delete(),x.delete(),u.delete()}l.delete(),n.delete(),i.delete()}function Vt({model:e}){const t=e.inputMetadata[0],r=e.outputMetadata[0];async function s(o,a){const l=mt(a,{confidence:.3,unclipRatio:1.75,boxMinArea:64}),n=await B(),i=await et(o),c=i.size(),d=new n.Size(t.shape[3],t.shape[2]),u=dt(c,d),f=new n.Mat,h=new n.Mat;await u.scaleMat(i,f),n.cvtColor(f,h,n.COLOR_RGBA2BGR);const p=n.blobFromImage(h,1/255,h.size(),new n.Scalar(0,0,0),!0,!1),y=new ct("float32",p.data32F,[1,...t.shape.slice(1)]),m=(await e.run({[t.name]:y}))[r.name],T=m.data,x=n.matFromArray(r.shape[3],r.shape[2],n.CV_8UC1,Uint8ClampedArray.from(T,R=>wt(R)>=l.confidence?255:0)),b=new n.MatVector,C=new n.Mat;n.findContours(x,b,C,n.RETR_EXTERNAL,n.CHAIN_APPROX_SIMPLE);const P=[];for(let R=0;R<b.size();R++){const I=b.get(R),A=new n.Mat;n.convexHull(I,A,!0,!0);const E=n.contourArea(A),O=n.arcLength(A,!0);if(E>l.boxMinArea&&O>0){const _=Math.ceil(E*l.unclipRatio/O),M=n.boundingRect(I),g=await u.revertRect(new n.Rect(M.x-_,M.y-_,M.width+_*2,M.height+_*2));P.push({bbox:[g.x,g.y,g.x+g.width,g.y+g.height]})}A.delete(),I.delete()}return y.dispose(),m.dispose(),x.delete(),p.delete(),f.delete(),h.delete(),i.delete(),P.sort((R,I)=>I.bbox[0]-R.bbox[0]),P}return{predict:s}}const jt="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~°£€¥¢฿àâéèêëîïôùûüçÀÂÉÈÊËÎÏÔÙÛÜÇ";function Yt({model:e,vocab:t=jt}){const r=e.inputMetadata[0],s=e.outputMetadata[0];async function o(l){const n=await B(),i=await Promise.all(l.map(async b=>{const C=await et(b),P=C.size(),R=new n.Size(r.shape[3],r.shape[2]),I=dt(P,R,pt.TOP_LEFT),A=new n.Mat,E=new n.Mat;await I.scaleMat(C,A,new n.Scalar(255,255,255,255)),n.cvtColor(A,E,n.COLOR_RGBA2BGR);const O=n.blobFromImage(E,1/255,E.size(),new n.Scalar(0,0,0),!0,!1);return A.delete(),E.delete(),C.delete(),O})),c=[i.length,...r.shape.slice(1)],d=new Float32Array(c.reduce((b,C)=>b*C,1));for(const b of i){const C=i.indexOf(b)*c.slice(1).reduce((P,R)=>P*R,1);d.set(b.data32F,C),b.delete()}const u=new ct("float32",d,c),h=(await e.run({[r.name]:u}))[s.name],p=h.data,[y,w,m]=h.dims,T=m-1,x=[];for(let b=0;b<y;b++){const C=[],P=b*w*m;let R=1;for(let E=0;E<w;E++){const O=E*m+P,_=p.slice(O,O+m),M=St(_),g=vt(M);C.push(g),M[g]<R&&(R=M[g])}const I=[];let A=-1;for(const E of C)E!==A&&E!==T&&I.push(E),A=E;x.push(I.map(E=>t[E]).join(""))}return u.dispose(),h.dispose(),x}async function a(l){return(await o([l]))[0]}return{predict:a,predictBatch:o}}function Q(e,t){return`${((t-e)/1e3).toFixed(2)}s`}function G(e){document.querySelector("#note").textContent=e}async function zt(){const e=document.querySelector("#fileinput"),t=document.querySelector("#input"),r=document.querySelector("#crop"),s=document.querySelector("#output"),o=document.querySelector("#filter"),a=document.querySelector("#grayed"),l=document.querySelector("#text-mask");G("Initiating OpenCV ...");const n=await B();G("Initiating ONNX Runtime ...");const i=await ht(()=>import("./ort.bundle.min-D7xVg6BR.js"),__vite__mapDeps([2,1]));G("Initiating YOLO Model ...");const c=Ft({model:await i.default.InferenceSession.create(gt),labels:["kartu","ktp","ktp-fc"]});e.disabled=!1,G("Initiating DBNet Model ...");const d=Vt({model:await i.InferenceSession.create(xt)});G("Initiating CRNN Model ...");const u=Yt({model:await i.InferenceSession.create(Et)});G("Ready!");const f=[new n.Scalar(0,255,0,255),new n.Scalar(0,0,255,255),new n.Scalar(255,0,0,255)];let h=0,p=0,y=0,w=0,m=0,T=0,x=0,b=0;e.addEventListener("input",async()=>{const C=e.files?.[0];if(!C)return;h=performance.now();const P=await et(C);n.imshow(t,P),y=performance.now();const R=await c.predict(P);w=performance.now();const I=R.find(A=>{const E=A.bbox[2]-A.bbox[0],O=A.bbox[3]-A.bbox[1],_=Math.max(E,O),M=Math.min(E,O),g=_/M;return A.classId===1&&_>100&&g>1&&g<2});if(I){const A=new n.Mat,E=new n.Rect(I.bbox[0],I.bbox[1],I.bbox[2]-I.bbox[0],I.bbox[3]-I.bbox[1]),O=n.matFromArray(E.height,E.width,n.CV_8UC1,I.mask),_=P.roi(E),M=new n.Mat,g=new n.MatVector;n.split(_,g),g.set(3,O),n.merge(g,M),n.imshow(r,M),await $t(P,A,E,O,new n.Size(1024,646));const k=new n.Mat,D=new n.Mat;await Ut(A,k,5),Gt(_,O,f[I.classId],.4),n.cvtColor(k,D,n.COLOR_RGBA2GRAY),n.cvtColor(D,D,n.COLOR_GRAY2RGBA),n.rectangle(P,new n.Point(E.x,E.y),new n.Point(E.x+E.width,E.y+E.height),f[I.classId],2),n.putText(P,I.label,new n.Point(E.x+10,E.y+20),n.FONT_HERSHEY_SIMPLEX,.7,new n.Scalar(255,255,255,255),1,n.LINE_AA,!1),m=performance.now();const W=await d.predict(D),$=new n.Mat(D.rows,D.cols,A.type(),new n.Scalar(255,255,255,255));T=performance.now();const nt=Tt(W,32);x=performance.now();for(const q of nt){const K=q.map(N=>{const L=new n.Rect(N.bbox[0],N.bbox[1],N.bbox[2]-N.bbox[0],N.bbox[3]-N.bbox[1]);return D.roi(L)}),ot=await u.predictBatch(K);for(const[N,L]of q.entries()){const U=ot[N],F=K[N],H=new n.Point(L.bbox[0],L.bbox[1]),V=new n.Point(L.bbox[2],L.bbox[3]),j=new n.Point(H.x+10,H.y+Math.floor((V.y-H.y)/2)+8);n.putText($,U,j,n.FONT_HERSHEY_SIMPLEX,.7,new n.Scalar(0,0,0,255),1,n.LINE_AA,!1),n.rectangle($,H,V,new n.Scalar(0,0,0,255),1),F.delete()}}b=performance.now(),n.imshow(t,P),n.imshow(s,A),n.imshow(o,k),n.imshow(a,D),n.imshow(l,$),_.delete(),g.delete(),O.delete(),M.delete(),$.delete(),p=performance.now(),k.delete(),D.delete(),A.delete(),G(`Success!
        Time: ${Q(h,p)} (
        Detect Object: ${Q(y,w)},
        Detect Text: ${Q(m,T)},
        Recognize Text: ${Q(x,b)}
      )`)}else{const A=n.Mat.zeros(404,640,n.CV_8UC4);n.imshow(r,A),n.imshow(s,A),n.imshow(o,A),n.imshow(a,A),A.delete(),G("Failed, Cannot find KTP in this image")}P.delete()})}document.addEventListener("DOMContentLoaded",()=>{zt().catch(e=>{const t=e instanceof Error?e.message:e;G(`Error, ${t}`)})});
