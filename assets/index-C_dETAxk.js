const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/opencv-D58UuVCI.js","assets/index-rQLcFmgX.js","assets/ort.bundle.min-D7xVg6BR.js"])))=>i.map(i=>d[i]);
(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();const Mt="modulepreload",xt=function(e){return"/"+e},at={},ft=function(s,c,o){let t=Promise.resolve();if(c&&c.length>0){let f=function(r){return Promise.all(r.map(d=>Promise.resolve(d).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var i=f;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=l?.nonce||l?.getAttribute("nonce");t=f(c.map(r=>{if(r=xt(r),r in at)return;at[r]=!0;const d=r.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${y}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Mt,d||(h.as="script"),h.crossOrigin="",h.href=r,a&&h.setAttribute("nonce",a),document.head.appendChild(h),d)return new Promise((u,w)=>{h.addEventListener("load",u),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${r}`)))})}))}function n(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return t.then(l=>{for(const a of l||[])a.status==="rejected"&&n(a.reason);return s().catch(n)})},St="/assets/yolov11n-DKSFrVWF.onnx";function Ct(e){return 1/(1+Math.exp(-e))}function _t(e,s){return Math.hypot(e.x-s.x,e.y-s.y)}function k(e,s){const c=s.y-e.y,o=s.x-e.x;return(360-Math.atan2(c,o)*180/Math.PI)%360}function v(e,s,c){return Math.min(Math.max(e,s),c)}function K(e){if(e===null||typeof e!="object")return!1;const s=Object.getPrototypeOf(e);return s!==null&&s!==Object.prototype&&Object.getPrototypeOf(s)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function Z(e,s,c=".",o){if(!K(s))return Z(e,{},c,o);const t=Object.assign({},s);for(const n in e){if(n==="__proto__"||n==="constructor")continue;const i=e[n];i!=null&&(o&&o(t,n,i,c)||(Array.isArray(i)&&Array.isArray(t[n])?t[n]=[...i,...t[n]]:K(i)&&K(t[n])?t[n]=Z(i,t[n],(c?`${c}.`:"")+n.toString(),o):t[n]=i))}return t}function Pt(e){return(...s)=>s.reduce((c,o)=>Z(c,o,"",e),{})}const Rt=Pt();let W;async function T(){if(!W){const{default:e}=await ft(async()=>{const{default:s}=await import("./opencv-D58UuVCI.js").then(c=>c.o);return{default:s}},__vite__mapDeps([0,1]));W=e instanceof Promise?await e:e}return W}async function dt(e){const s=await T();if(e instanceof s.Mat)return e.clone();const c=new Image;return c.src=e instanceof Blob?URL.createObjectURL(e):e,await c.decode(),e instanceof Blob&&URL.revokeObjectURL(c.src),s.imread(c)}function At(e,s,c,o){const t=Math.min(c/e,o/s),n=Math.floor(e*t),i=Math.floor(s*t),l=c-n,a=o-i,f=Math.floor(l/2),r=Math.floor(a/2),d=l-f,y=a-r;return{ratio:t,size:[n,i],padding:[r,d,y,f]}}async function Et(e,s,c=10){const o=await T(),t=new o.Mat,n=new o.MatVector;o.cvtColor(e,t,o.COLOR_RGBA2GRAY),n.push_back(t);const i=256,l=[0,256],a=new o.Mat,f=new o.Mat;o.calcHist(n,[0],f,a,[i],l);const r=[a.data32F[0]];for(let m=1;m<i;m++)r[m]=r[m-1]+a.data32F[m];const d=r[i-1],y=c*d/100/2;let h=0;for(;r[h]<y;)h++;let u=i-1;for(;r[u]>=d-y;)u--;const w=255/(u-h),p=-h*w;e.convertTo(s,-1,w,p),n.delete(),t.delete(),a.delete(),f.delete()}function Ot(e,s,c,o=.5){for(let t=0;t<e.rows;t++)for(let n=0;n<e.cols;n++){const i=s.ucharPtr(t,n)[0],l=o*i/255,a=1-l,f=e.ucharPtr(t,n);for(let r=0;r<e.channels();r++)f[r]=f[r]*a+c[r]*l}}function vt({ort:e,modelPath:s,labels:c}){let o,t;async function n(){o=await T(),t=await e.InferenceSession.create(s)}async function i(l,a){const f=Rt(a,{confidence:.8});(!t||!o)&&await n();const r=t.inputMetadata[0],d=t.outputMetadata[0],y=t.outputMetadata[1],h=await dt(l),u=h.size(),w=new o.Size(r.shape[2],r.shape[3]),p=At(u.width,u.height,w.width,w.height),m=new o.Size(p.size[0],p.size[1]),b=p.ratio,[S,x,P,C]=p.padding,_=new o.Mat,R=new o.Mat;o.resize(h,_,m),o.copyMakeBorder(_,_,S,P,C,x,o.BORDER_CONSTANT,new o.Scalar(0,0,0,255)),o.cvtColor(_,R,o.COLOR_RGBA2BGR);const I=o.blobFromImage(R,1/255,R.size(),new o.Scalar(0,0,0),!0,!1),N=new e.Tensor("float32",I.data32F,r.shape),z=await t.run({[r.name]:N}),A=z[d.name],g=z[y.name],M=d.shape[1],ht=d.shape[2],L=A.data,wt=g.data,J=y.shape[1],D=new o.Size(y.shape[2],y.shape[3]),Q=D.width*D.height,tt=[];for(let G=0;G<M;G++){const E=G*ht,et=L[E+4],U=L[E+5];if(et<f.confidence||U<0||U>=c.length)continue;const X=v(Math.floor(L[E]),0,w.width),q=v(Math.floor(L[E+1]),0,w.height),ot=v(Math.ceil(L[E+2]),0,w.width),nt=v(Math.ceil(L[E+3]),0,w.height),mt=L.slice(E+6,E+6+J),yt=Float32Array.from({length:Q},($,V)=>{let j=0;for(let F=0;F<J;F++)j+=mt[F]*wt[F*Q+V];return Ct(j)}),pt=new o.Rect(X,q,ot-X,nt-q),B=o.matFromArray(D.height,D.width,o.CV_8UC1,Uint8ClampedArray.from(yt,$=>$*255));o.resize(B,B,w,0,0,o.INTER_CUBIC);const O=B.roi(pt),st=v(Math.floor((X-C)/b),0,u.width),ct=v(Math.floor((q-S)/b),0,u.height),rt=v(Math.ceil((ot-C)/b),0,u.width),it=v(Math.ceil((nt-S)/b),0,u.height),bt=rt-st,gt=it-ct;o.resize(O,O,new o.Size(bt,gt),0,0,o.INTER_CUBIC),tt.push({classId:U,label:c[U],confidence:et,bbox:[st,ct,rt,it],mask:Uint8ClampedArray.from({length:O.rows*O.cols},($,V)=>{const j=Math.floor(V/O.cols),F=V%O.cols;return O.ucharPtr(j,F)[0]})}),B.delete(),O.delete()}return N.dispose(),A.dispose(),g.dispose(),h.delete(),_.delete(),R.delete(),I.delete(),tt}return{predict:i}}function Y(e,s){const[c,o,t,n]=e,[i,l,a,f]=s,r=n-o,d=c-t,y=r*c+d*o,h=f-l,u=i-a,w=h*i+u*l,p=r*u-h*d;if(p===0)return;const m=(u*y-d*w)/p,b=(r*w-h*y)/p;return[m,b]}function H(e,s,c=!1){const o=e.length;if(!(o<2))if(c){let t=0,n=0,i=0,l=0;for(const{x:u,y:w}of e)t+=u,n+=w,i+=u*w,l+=w*w;const a=(o*i-n*t)/(o*l-n*n+1e-6),f=(t-a*n)/o,r=0,d=a*0+f,y=s.height,h=a*s.height+f;return[d,r,h,y]}else{let t=0,n=0,i=0,l=0;for(const{x:u,y:w}of e)t+=u,n+=w,i+=u*w,l+=u*u;const a=(o*i-t*n)/(o*l-t*t+1e-6),f=(n-a*t)/o,r=0,d=a*0+f,y=s.width,h=a*s.width+f;return[r,d,y,h]}}async function Tt(e){const s=await T(),c=s.minAreaRect(e),o=c.center;let t=new s.Point(0,0),n=0,i=new s.Point(0,0),l=0,a=new s.Point(0,0),f=0,r=new s.Point(0,0),d=0;for(let A=0;A<e.data32S.length;A+=2){const g=new s.Point(e.data32S[A],e.data32S[A+1]),M=_t(g,o);g.x<o.x&&g.y<o.y?M>n&&(t=g,n=M):g.x>o.x&&g.y<o.y?M>l&&(i=g,l=M):g.x<o.x&&g.y>o.y?M>f&&(a=g,f=M):g.x>o.x&&g.y>o.y&&M>d&&(r=g,d=M)}const y=k(o,i),h=k(o,t),u=k(o,a),w=k(o,r),p=[t,i],m=[a,r],b=[t,a],S=[i,r];for(let A=0;A<e.data32S.length;A+=2){const g=new s.Point(e.data32S[A],e.data32S[A+1]),M=k(o,g);M>y&&M<h?p.push(g):M>h&&M<u?b.push(g):M>u&&M<w?m.push(g):(M>w||M<y)&&S.push(g)}const x=H(p,c.size),P=H(m,c.size),C=H(b,c.size,!0),_=H(S,c.size,!0);if(!x||!P||!C||!_)return[t,i,a,r];const R=Y(x,C),I=Y(x,_),N=Y(P,_),z=Y(P,C);return!R||!I||!N||!z?[t,i,a,r]:[new s.Point(R[0],R[1]),new s.Point(I[0],I[1]),new s.Point(z[0],z[1]),new s.Point(N[0],N[1])]}async function lt(e){let s=-1,c=Number.NEGATIVE_INFINITY;const o=await T();for(let t=0;t<e.size();t++){const n=e.get(t),i=o.contourArea(n);i>c&&(c=i,s=t),n.delete()}return s}async function Lt(e,s){const c=await T(),o=new c.Mat,t=new c.Mat;c.bitwise_and(e,s,o),c.bitwise_or(e,s,t);const n=c.countNonZero(o),i=c.countNonZero(t),l=i>0?n/i:0;return o.delete(),t.delete(),l}async function It(e,s,c,o){const t=await T(),n=new t.MatVector,i=new t.Mat,l=e.roi(c);t.cvtColor(l,l,t.COLOR_RGBA2GRAY);for(let f=0;f<l.rows;f++)for(let r=0;r<l.cols;r++)l.ucharPtr(f,r)[0]=Math.floor(l.ucharPtr(f,r)[0]*(o.ucharPtr(f,r)[0]/255));t.threshold(l,l,128,255,t.THRESH_BINARY+t.THRESH_OTSU),t.findContours(l,n,i,t.RETR_EXTERNAL,t.CHAIN_APPROX_SIMPLE);let a=await lt(n);if(a>-1){const f=n.get(a),r=new t.Mat;t.convexHull(f,r,!0,!0),n.set(a,r),f.delete();const d=t.Mat.zeros(o.rows,o.cols,t.CV_8UC1);if(t.drawContours(d,n,a,new t.Scalar(255),t.FILLED),await Lt(d,o)<.9&&(t.findContours(o,n,i,t.RETR_EXTERNAL,t.CHAIN_APPROX_SIMPLE),a=await lt(n),a>-1)){const x=n.get(a);t.convexHull(x,r,!0,!0),n.set(a,r),x.delete()}d.delete();const h=await Tt(r),u=c.height>c.width,w=u?404:640,p=u?640:404,m=t.matFromArray(4,1,t.CV_32FC2,h.flatMap(({x,y:P})=>[c.x+x,c.y+P])),b=t.matFromArray(4,1,t.CV_32FC2,[0,0,w,0,0,p,w,p]),S=t.getPerspectiveTransform(m,b);t.warpPerspective(e,s,S,new t.Size(w,p),t.INTER_CUBIC,t.BORDER_CONSTANT,new t.Scalar),u&&t.rotate(s,s,t.ROTATE_90_COUNTERCLOCKWISE),m.delete(),b.delete(),r.delete()}n.delete(),i.delete(),l.delete()}function ut(e){return`${(e/1e3).toFixed(2)}s`}document.addEventListener("DOMContentLoaded",async()=>{const e=await T(),s=await ft(()=>import("./ort.bundle.min-D7xVg6BR.js"),__vite__mapDeps([2,1])),c=vt({ort:s.default,modelPath:St,labels:["kartu","ktp","ktp-fc"]}),o=[new e.Scalar(0,255,0,255),new e.Scalar(0,0,255,255),new e.Scalar(255,0,0,255)],t=document.querySelector("#note"),n=document.querySelector("#fileinput"),i=document.querySelector("#input"),l=document.querySelector("#crop"),a=document.querySelector("#output"),f=document.querySelector("#filter"),r=document.querySelector("#grayed");let d=0,y=0;n.addEventListener("input",async()=>{const h=n.files?.[0];if(!h)return;d=performance.now();const u=await dt(h);e.imshow(i,u);const w=await c.predict(u);y=performance.now()-d;const p=w.find(m=>{const b=m.bbox[2]-m.bbox[0],S=m.bbox[3]-m.bbox[1],x=Math.max(b,S),P=Math.min(b,S),C=x/P;return m.classId===1&&x>100&&C>1&&C<2});if(p){const m=new e.Mat,b=new e.Rect(p.bbox[0],p.bbox[1],p.bbox[2]-p.bbox[0],p.bbox[3]-p.bbox[1]),S=e.matFromArray(b.height,b.width,e.CV_8UC1,p.mask),x=u.roi(b),P=new e.Mat,C=new e.MatVector;e.split(x,C),C.set(3,S),e.merge(C,P),e.imshow(l,P),await It(u,m,b,S);const _=new e.Mat,R=new e.Mat;await Et(m,_,5),Ot(x,S,o[p.classId],.4),e.cvtColor(_,R,e.COLOR_RGBA2GRAY),e.rectangle(u,new e.Point(b.x,b.y),new e.Point(b.x+b.width,b.y+b.height),o[p.classId],2),e.putText(u,p.label,new e.Point(b.x+10,b.y+20),e.FONT_HERSHEY_SIMPLEX,.7,new e.Scalar(255,255,255,255),1,e.LINE_AA,!1),e.imshow(i,u),e.imshow(a,m),e.imshow(f,_),e.imshow(r,R),x.delete(),C.delete(),S.delete(),P.delete(),_.delete(),R.delete(),m.delete(),t.textContent=`Success, Time: ${ut(performance.now()-d)} (Detect: ${ut(y)})`}else{const m=e.Mat.zeros(404,640,e.CV_8UC4);e.imshow(l,m),e.imshow(a,m),e.imshow(f,m),e.imshow(r,m),m.delete(),t.textContent="Failed, Cannot find KTP in this image"}u.delete()})});
